---
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import Headline from '~/components/ui/Headline.astro';
import { Icon } from 'astro-icon/components';
import Button from '~/components/ui/Button.astro';
import type { CallToAction } from '~/types';

interface StepItem {
  title: string;
  description?: string;
  icon?: string;
  callToAction?: CallToAction;
}

export interface Props {
  id?: string;
  title?: string;
  subtitle?: string;
  tagline?: string;
  items?: StepItem[];
  isDark?: boolean;
}

const {
  id,
  title = 'How it works',
  subtitle = '',
  tagline = '',
  items = [],
  isDark = false,
} = Astro.props as Props;
---

<WidgetWrapper id={id} isDark={isDark} containerClass="max-w-7xl mx-auto">
  <Headline title={title} subtitle={subtitle} tagline={tagline} />

  <div class="relative">
    <ol class="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8 items-stretch">
      {items.map((item, idx) => (
        <li class="group relative flex flex-col rounded-xl border border-gray-200 dark:border-gray-700 bg-white/90 dark:bg-slate-900/70 p-6 md:p-8 shadow-sm transition">
          <div class="flex items-center gap-3">
            <span class="inline-flex items-center justify-center text-sm md:text-base font-semibold rounded-full border border-gray-600 bg-gray-100 text-gray-800 px-3 py-1">
              Step {idx + 1}
            </span>
            {item.icon && <Icon name={item.icon} class="w-7 h-7 text-gray-700" />}
          </div>
          <h3 class="mt-4 text-xl md:text-2xl font-semibold leading-snug">{item.title}</h3>
          {item.description && <p class="mt-3 text-base text-muted">{item.description}</p>}
          {item.callToAction && (
            <div class="mt-4">
              <Button {...item.callToAction} />
            </div>
          )}

          {idx < items.length - 1 && (
            <div class="hidden md:block absolute top-1/2 right-[-32px] -translate-y-1/2 animate-pulse" aria-hidden="true">
              <svg width="64" height="20" viewBox="0 0 64 20" fill="none" xmlns="http://www.w3.org/2000/svg" class="drop-shadow-sm">
                <path d="M2 10h52" stroke="currentColor" stroke-opacity="0.4" stroke-width="5" stroke-linecap="round" />
                <path d="M54 4l8 6-8 6" fill="currentColor" class="text-primary" />
                <circle cx="10" cy="10" r="2" fill="currentColor" class="text-primary opacity-60" />
                <circle cx="20" cy="10" r="1.5" fill="currentColor" class="text-primary opacity-40" />
                <circle cx="30" cy="10" r="1" fill="currentColor" class="text-primary opacity-30" />
              </svg>
            </div>
          )}
        </li>
      ))}
    </ol>
  </div>
</WidgetWrapper>


