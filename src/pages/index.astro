---
import Layout from '~/layouts/PageLayout.astro';
import OptimizedImage from '~/components/common/OptimizedImage.astro';
import { Icon } from 'astro-icon/components';
import { siteConfig, policyCopy } from '~/config/site';

// Import hero image
import mainHeroImage from '~/assets/images/new-hero-image.jpg';

import Hero from '~/components/widgets/Hero.astro';
import Note from '~/components/widgets/Note.astro';
import Features from '~/components/widgets/Features.astro';
import Features2 from '~/components/widgets/Features2.astro';
// Removed template filler widgets for a clean marketing page
import FAQs from '~/components/widgets/FAQs.astro';
import Stats from '~/components/widgets/Stats.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';
import LiveReviews from '~/components/widgets/LiveReviews.astro';
import Process from '~/components/widgets/Process.astro';
import TrustBar from '~/components/widgets/TrustBar.astro';
import ReviewsSchema from '~/components/seo/ReviewsSchema.astro';

const metadata = {
  title: 'Window Cleaning Somerset | Instant Online Quotes & Booking | Somerset Window Cleaning',
  description: 'Get instant quotes and book window cleaning online in Somerset. Reliable, fully insured service with 48-hour guarantee. Serving Bath, Wells, Street, Glastonbury & more.',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata} structuredDataType="homepage">
  <!-- Hero Widget ******************* -->

  <Hero
    actions={[
      { variant: 'primary', text: 'Book Now', href: '/book-now', icon: 'tabler:calendar-plus', class: 'text-white text-lg px-8 py-4 animate-pulse shadow-2xl transform hover:scale-110 transition-all duration-300' },
      { variant: 'secondary', text: 'Call 01458 860339', href: 'tel:01458860339', icon: 'tabler:phone', class: 'text-white text-lg px-6 py-4 border-2 border-primary hover:bg-primary/15 transition-all duration-300' },
      { variant: 'whatsapp', text: 'WhatsApp', href: 'https://wa.me/447415526331?text=Hi%20Somerset%20Window%20Cleaning%2C%20please%20can%20I%20get%20a%20quote%20for%20window%20cleaning%20at%20%5Byour%20address%5D', icon: 'tabler:brand-whatsapp', class: 'text-white text-lg px-6 py-4', target: '_blank' },
    ]}
  >
    <Fragment slot="bg">
      <OptimizedImage 
        src={mainHeroImage} 
        alt="Professional window cleaning service across Somerset - aerial view of technician cleaning modern home windows with water-fed pole system" 
        width={1600} 
        height={900} 
        quality={90}
        formats={['avif', 'webp', 'jpg']}
        critical={true}
        blurUp={false}
        preload={true}
        sizes="100vw"
        widths={[640, 768, 1024, 1280, 1600, 1920]}
        style="width:100%; height:100%; object-fit:cover; opacity:0.55;" 
      />
      <div class="absolute inset-0 bg-black/40"></div>
    </Fragment>
    <Fragment slot="title">
      <span style="color: #dc2626 !important;">Professional</span> Window Cleaning <span style="color: #dc2626 !important;">Somerset</span>
    </Fragment>
    <Fragment slot="subtitle">
      <span class="text-white">Reliable, fully insured exterior cleaning across Somerset. 4,000+ happy customers since 2019.</span>
    </Fragment>
  </Hero>

  <!-- Stats Bar ****************** -->
  <Stats 
    isDark={true}
    stats={[
      {
        amount: 'Fully',
        title: 'INSURED',
        description: '£5M Public Liability'
      },
      {
        amount: 'Online',
        title: 'PAYMENTS',
        description: 'Card & Direct Debit'
      },
      {
        amount: '190+',
        title: 'GOOGLE REVIEWS',
        description: '4.9★ Rating'
      },
      {
        amount: '48hr',
        title: 'GUARANTEE',
        description: 'Spot-free Promise'
      },
    ]}
  />

  <!-- Services Widget *************** -->
  <Features
    id="services"
    title="Complete Exterior Cleaning Services"
    subtitle="Professional, reliable, fully insured exterior cleaning across Somerset."
    items={[
      {
        title: 'Window Cleaning',
        description: 'Pure water system for streak-free windows. Frames and sills included.',
        icon: 'tabler:sparkles',
        callToAction: { text: 'Learn More', href: '/services/window-cleaning' },
      },
      {
        title: 'Gutter Clearing',
        description: 'High-reach vacuum system removes leaves and debris safely.',
        icon: 'tabler:brand-abstract',
        callToAction: { text: 'Learn More', href: '/services/gutter-cleaning' },
      },
      {
        title: 'Fascia & Soffit Cleaning',
        description: 'Restore UPVC fascias and soffits to their original appearance.',
        icon: 'tabler:home',
        callToAction: { text: 'Learn More', href: '/services/fascia-soffit-cleaning' },
      },
      {
        title: 'Conservatory Cleaning',
        description: 'Roof panels and frames carefully cleaned to restore clarity.',
        icon: 'tabler:building',
        callToAction: { text: 'Learn More', href: '/services/conservatory-cleaning' },
      },
      {
        title: 'Solar Panel Cleaning',
        description: 'Specialist cleaning to maintain efficiency and warranties.',
        icon: 'tabler:sun',
        callToAction: { text: 'Learn More', href: '/services/solar-panel-cleaning' },
      },
      {
        title: 'Commercial Cleaning',
        description: 'Professional service for offices, shops and business premises.',
        icon: 'tabler:building-store',
        callToAction: { text: 'Get Quote', href: '/services/commercial-window-cleaning' },
      },
    ]}
  />

  <!-- Service Coverage Area Quick Check -->
  <section class="py-8 bg-black text-white intersect-once intersect-quarter motion-safe:md:opacity-0 motion-safe:md:intersect:animate-fade">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="text-center">
        <h2 class="text-2xl md:text-3xl font-bold mb-3">We Cover <span class="text-red-500">38+ Postcodes</span> Across Somerset</h2>
        <p class="text-gray-300 mb-6">Professional window cleaning from <span class="text-red-400">Bath to Bridgwater</span>, <span class="text-red-400">Wells to Weston-super-Mare</span></p>
        
        <!-- Quick postcode checker -->
        <div class="max-w-md mx-auto mb-6">
          <div class="flex gap-2">
            <input 
              type="text" 
              id="homepage-postcode" 
              placeholder="Enter your postcode (e.g. BA16 0HW)"
              class="flex-1 px-4 py-2 border border-gray-600 bg-gray-800 text-white rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent text-sm placeholder-gray-400"
            >
            <button 
              id="homepage-check" 
              class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium text-sm shadow-lg"
            >
              Check
            </button>
          </div>
          <div id="homepage-result" class="mt-3 text-sm hidden"></div>
        </div>

        <!-- Coverage highlights -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm">
          <div class="bg-gray-800 border border-gray-700 p-3 rounded-lg shadow-sm">
            <div class="font-semibold text-red-500">BS Postcodes</div>
            <div class="text-gray-400">North Somerset</div>
          </div>
          <div class="bg-gray-800 border border-gray-700 p-3 rounded-lg shadow-sm">
            <div class="font-semibold text-red-500">BA Postcodes</div>
            <div class="text-gray-400">Bath & NE Somerset</div>
          </div>
          <div class="bg-gray-800 border border-gray-700 p-3 rounded-lg shadow-sm">
            <div class="font-semibold text-red-500">TA Postcodes</div>
            <div class="text-gray-400">Somerset Levels</div>
          </div>
          <div class="bg-gray-800 border border-gray-700 p-3 rounded-lg shadow-sm">
            <div class="font-semibold text-red-500">DT9 Postcode</div>
            <div class="text-gray-400">West Dorset</div>
          </div>
        </div>

        <div class="mt-6">
          <a 
            href="/areas" 
            class="inline-flex items-center text-primary hover:text-primary/80 font-medium text-sm"
          >
            View All Coverage Areas
            <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
            </svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Reviews ******************************* -->
  <LiveReviews 
    title="What our customers say"
    subtitle="Real reviews from verified Google customers"
    maxReviews={6}
    autoRotate={true}
  />

  <!-- Removed mid-page CTA (duplicate of contact options) -->
  
  <!-- Reviews structured data for homepage -->
  <ReviewsSchema />
</Layout>

<script>
  // Homepage postcode checker
  document.addEventListener('DOMContentLoaded', function() {
    const supportedPostcodes = [
      'BS21', 'BS23', 'BS24', 'BS25', 'BS26', 'BS27', 'BS28', 'BS29', 'BS39', 'BS40', 'BS49',
      'BA3', 'BA4', 'BA5', 'BA6', 'BA7', 'BA8', 'BA9', 'BA10', 'BA11', 'BA16', 'BA20', 'BA21', 'BA22',
      'TA2', 'TA6', 'TA7', 'TA8', 'TA9', 'TA10', 'TA11', 'TA12', 'TA13', 'TA14', 'TA18', 'TA19', 'TA20',
      'DT9'
    ];

    const input = document.getElementById('homepage-postcode');
    const button = document.getElementById('homepage-check');
    const result = document.getElementById('homepage-result');

    if (!input || !button || !result) return;

    function checkPostcode() {
      const postcode = input.value.toUpperCase().replace(/\s/g, '');
      const postcodePrefix = postcode.match(/^[A-Z]{1,2}[0-9]{1,2}/)?.[0];
      
      result.classList.remove('hidden');
      
      if (!postcodePrefix) {
        result.className = 'mt-3 text-sm p-2 rounded bg-gray-100 text-gray-600';
        result.textContent = 'Please enter a valid postcode';
        return;
      }

      if (supportedPostcodes.includes(postcodePrefix)) {
        result.className = 'mt-3 text-sm p-2 rounded bg-green-800 text-green-200 font-medium';
        result.innerHTML = `✅ Yes! We cover ${postcodePrefix} - Redirecting...`;
        // Redirect to celebration page
        setTimeout(() => {
          window.location.href = `/postcode-celebration?postcode=${encodeURIComponent(postcode)}`;
        }, 500);
      } else {
        result.className = 'mt-3 text-sm p-2 rounded bg-orange-900 text-orange-200';
        result.innerHTML = `We don't cover ${postcodePrefix} yet - <a href="/areas" class="underline hover:no-underline">See full coverage</a>`;
      }
    }

    button.addEventListener('click', checkPostcode);
    input.addEventListener('keypress', function(e) {
      if (e.key === 'Enter') checkPostcode();
    });
  });
</script>
