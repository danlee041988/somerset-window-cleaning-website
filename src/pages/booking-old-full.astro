---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import WidgetWrapper from '~/components/ui/WidgetWrapper.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Image from '~/components/common/Image.astro';

const metadata = {
  title: 'Book Window Cleaning Online - Somerset Window Cleaning | Instant Quote & Booking',
  description: 'Book professional window cleaning in Somerset online. Get instant pricing for residential and commercial properties. Fully insured service with transparent pricing.',
};
---

<Layout metadata={metadata}>
  <!-- Hero Section -->
  <Hero>
    <Fragment slot="title">
      Professional Window Cleaning <span class="text-accent">Book Online</span>
    </Fragment>
    <Fragment slot="subtitle">
      Instant Quote & Book Online - Select your property type for transparent pricing
    </Fragment>
    <Fragment slot="bg">
      <Image src="~/assets/images/solar-panels.jpeg" alt="" width={1600} height={900} layout="cover" style="width:100%; height:100%; object-fit:cover; opacity:0.35;" />
      <div class="absolute inset-0 bg-gradient-to-br from-gray-800/60 via-gray-700/60 to-blue-900/60"></div>
    </Fragment>
  </Hero>

  <!-- Multi-Step Booking Form -->
  <div class="bg-gray-900 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-8">
      
      <!-- Progress Steps -->
      <div class="mb-8">
        <div class="flex items-center justify-center space-x-4 mb-6">
          <div class="flex items-center">
            <div id="step-1-indicator" class="w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300">1</div>
            <span class="ml-2 text-sm font-medium text-white">Property</span>
          </div>
          <div class="w-8 h-1 bg-gray-600">
            <div id="progress-1" class="h-full bg-red-600 transition-all duration-300" style="width: 0%"></div>
          </div>
          <div class="flex items-center">
            <div id="step-2-indicator" class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300">2</div>
            <span class="ml-2 text-sm font-medium text-gray-300">Services</span>
          </div>
          <div class="w-8 h-1 bg-gray-600">
            <div id="progress-2" class="h-full bg-red-600 transition-all duration-300" style="width: 0%"></div>
          </div>
          <div class="flex items-center">
            <div id="step-3-indicator" class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300">3</div>
            <span class="ml-2 text-sm font-medium text-gray-300">Details</span>
          </div>
          <div class="w-8 h-1 bg-gray-600">
            <div id="progress-3" class="h-full bg-red-600 transition-all duration-300" style="width: 0%"></div>
          </div>
          <div class="flex items-center">
            <div id="step-4-indicator" class="w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300">4</div>
            <span class="ml-2 text-sm font-medium text-gray-300">Review</span>
          </div>
        </div>
      </div>

      <div class="grid lg:grid-cols-3 gap-8">
        
        <!-- Left Column: Form Steps -->
        <div class="lg:col-span-2 space-y-8">
          
          <!-- Step 1: Property Selection -->
          <div id="step-1" class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-8">
            <h2 class="text-2xl font-bold text-white mb-6">Step 1: Select Your Property Type</h2>
            <p class="text-gray-300 mb-8">Choose your property type to get instant transparent pricing</p>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              
              <!-- 1-2 Bedroom Properties -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="property12bed" data-type="1-2 Bedroom" data-bedrooms="1-2 Bed" data-base-price="20">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">1-2 Bedroom</h3>
                  <p class="text-sm text-gray-300 mb-4">Small Properties</p>
                  <div class="text-lg font-bold text-red-400">From £20</div>
                </div>
              </div>

              <!-- 3 Bed Semi-Detached -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="sdh23" data-type="Semi-Detached" data-bedrooms="3 Bed" data-base-price="25">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">3 Bed Semi-Detached</h3>
                  <p class="text-sm text-gray-300 mb-4">3 Bedrooms</p>
                  <div class="text-lg font-bold text-red-400">From £25</div>
                </div>
              </div>

              <!-- 3 Bed Detached -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="dh23" data-type="Detached" data-bedrooms="3 Bed" data-base-price="30">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 3l10 9h-3v8h-5v-6H10v6H5v-8H2L12 3z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">3 Bed Detached</h3>
                  <p class="text-sm text-gray-300 mb-4">3 Bedrooms</p>
                  <div class="text-lg font-bold text-red-400">From £30</div>
                </div>
              </div>

              <!-- 4 Bed Semi-Detached -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="sdh4" data-type="Semi-Detached" data-bedrooms="4 Bed" data-base-price="30">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">4 Bed Semi-Detached</h3>
                  <p class="text-sm text-gray-300 mb-4">4 Bedrooms</p>
                  <div class="text-lg font-bold text-red-400">From £30</div>
                </div>
              </div>

              <!-- 4 Bed Detached -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="dh4" data-type="Detached" data-bedrooms="4 Bed" data-base-price="35">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 3l10 9h-3v8h-5v-6H10v6H5v-8H2L12 3z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">4 Bed Detached</h3>
                  <p class="text-sm text-gray-300 mb-4">4 Bedrooms</p>
                  <div class="text-lg font-bold text-red-400">From £35</div>
                </div>
              </div>

              <!-- 5 Bed Semi-Detached -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="sdh5" data-type="Semi-Detached" data-bedrooms="5 Bed" data-base-price="35">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">5 Bed Semi-Detached</h3>
                  <p class="text-sm text-gray-300 mb-4">5 Bedrooms</p>
                  <div class="text-lg font-bold text-red-400">From £35</div>
                </div>
              </div>

              <!-- 5 Bed Detached -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="dh5" data-type="Detached" data-bedrooms="5 Bed" data-base-price="40">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 3l10 9h-3v8h-5v-6H10v6H5v-8H2L12 3z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">5 Bed Detached</h3>
                  <p class="text-sm text-gray-300 mb-4">5 Bedrooms</p>
                  <div class="text-lg font-bold text-red-400">From £40</div>
                </div>
              </div>

              <!-- 6+ Beds Custom -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="custom6plus" data-type="Properties" data-bedrooms="6+ Beds" data-base-price="0" data-is-custom="true">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 2l9 7v11H15v-7h-2v7H3V9l9-7z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">6+ Beds & Bespoke</h3>
                  <p class="text-sm text-gray-300 mb-4">Large Properties</p>
                  <div class="text-lg font-bold text-red-400">Custom Quote</div>
                </div>
              </div>

              <!-- Commercial -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="commercial" data-type="Commercial" data-bedrooms="All Types" data-base-price="0" data-is-commercial="true">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M12 7V3H2v18h20V7H12zM6 19H4v-2h2v2zm0-4H4v-2h2v2zm0-4H4V9h2v2zm0-4H4V5h2v2zm4 12H8v-2h2v2zm0-4H8v-2h2v2zm0-4H8V9h2v2zm0-4H8V5h2v2zm10 12h-8v-2h2v-2h-2v-2h2v-2h-2V9h8v10zm-2-8h-2v2h2v-2zm0 4h-2v2h2v-2z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">Commercial</h3>
                  <p class="text-sm text-gray-300 mb-4">Business Properties</p>
                  <div class="text-lg font-bold text-red-400">Business Enquiry</div>
                </div>
              </div>

              <!-- General Enquiry -->
              <div class="property-card bg-gray-700 border-2 border-gray-600 p-6 rounded-xl hover:border-red-500 hover:bg-gray-600 transition-all duration-300 cursor-pointer"
                   data-service-id="other_services_enquiry" data-type="General Enquiry" data-bedrooms="Other Services" data-is-general="true">
                <div class="text-center">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-bold mb-2 text-white">General Enquiry</h3>
                  <p class="text-sm text-gray-300 mb-4">Other Services</p>
                  <div class="text-lg font-bold text-red-400">Get Quote</div>
                </div>
              </div>

            </div>

            <!-- Frequency Selection (shown after property selection) -->
            <div id="frequency-selection" class="hidden mt-8 p-6 bg-gray-700 rounded-xl border border-gray-600">
              <h3 class="text-lg font-semibold mb-4 text-white">Select Cleaning Frequency</h3>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button type="button" class="frequency-btn p-4 border-2 border-gray-600 rounded-lg text-center hover:border-red-500 hover:bg-gray-600 transition-all bg-gray-700"
                        data-frequency-id="4-weekly" data-adjustment="0">
                  <div class="font-semibold text-white">4 Weekly</div>
                  <div class="text-sm text-gray-300">Most Popular</div>
                </button>
                <button type="button" class="frequency-btn p-4 border-2 border-gray-600 rounded-lg text-center hover:border-red-500 hover:bg-gray-600 transition-all bg-gray-700"
                        data-frequency-id="8-weekly" data-adjustment="3">
                  <div class="font-semibold text-white">8 Weekly</div>
                  <div class="text-sm text-gray-300">+£3</div>
                </button>
                <button type="button" class="frequency-btn p-4 border-2 border-gray-600 rounded-lg text-center hover:border-red-500 hover:bg-gray-600 transition-all bg-gray-700"
                        data-frequency-id="12-weekly" data-adjustment="5">
                  <div class="font-semibold text-white">12 Weekly</div>
                  <div class="text-sm text-gray-300">+£5</div>
                </button>
                <button type="button" class="frequency-btn p-4 border-2 border-gray-600 rounded-lg text-center hover:border-red-500 hover:bg-gray-600 transition-all bg-gray-700"
                        data-frequency-id="adhoc" data-adjustment="20">
                  <div class="font-semibold text-white">One-off</div>
                  <div class="text-sm text-gray-300">+£20</div>
                </button>
              </div>
              <button type="button" id="continue-to-step-2" class="w-full mt-6 bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-lg transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                Continue to Additional Services
              </button>
            </div>
          </div>

          <!-- Step 2: Additional Services -->
          <div id="step-2" class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-8 hidden">
            <h2 class="text-2xl font-bold text-white mb-6">Step 2: Additional Services</h2>
            <div id="additional-services-content">
              <!-- Content will be populated by JavaScript based on property type -->
            </div>
          </div>

          <!-- Step 3: Property Details -->
          <div id="step-3" class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-8 hidden">
            <h2 class="text-2xl font-bold text-white mb-6">Step 3: Property Details</h2>
            <div id="property-details-content">
              <!-- Content will be populated by JavaScript -->
            </div>
          </div>

          <!-- Step 4: Review & Submit -->
          <div id="step-4" class="bg-gray-800 rounded-xl shadow-lg border border-gray-700 p-8 hidden">
            <h2 class="text-2xl font-bold text-white mb-6">Step 4: Review & Submit</h2>
            <div id="review-content">
              <!-- Content will be populated by JavaScript -->
            </div>
          </div>

        </div>

        <!-- Right Column: Price Summary & Info -->
        <div class="lg:col-span-1">
          <div class="sticky top-8 space-y-6">
            
            <!-- Price Summary - Always Visible -->
            <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
              <h3 class="text-xl font-bold text-white mb-4">Your Quote</h3>
              <div id="price-summary" class="space-y-3">
                <div class="text-center text-gray-400">
                  <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
                    </svg>
                  </div>
                  <p class="text-white">Select your property type to see pricing</p>
                </div>
              </div>
            </div>

            <!-- Service Benefits -->
            <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
              <h3 class="text-lg font-bold text-white mb-4">Why Choose Us?</h3>
              <div class="space-y-3">
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <div>
                    <div class="font-medium text-white">Fully Insured</div>
                    <div class="text-sm text-gray-300">£2M public liability</div>
                  </div>
                </div>
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <div>
                    <div class="font-medium text-white">48-Hour Guarantee</div>
                    <div class="text-sm text-gray-300">Spot-free guarantee</div>
                  </div>
                </div>
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <div>
                    <div class="font-medium text-white">Pure Water System</div>
                    <div class="text-sm text-gray-300">Streak-free finish</div>
                  </div>
                </div>
                <div class="flex items-start space-x-3">
                  <svg class="w-5 h-5 text-red-500 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                  </svg>
                  <div>
                    <div class="font-medium text-white">Professional Service</div>
                    <div class="text-sm text-gray-300">Since 2019</div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Contact Info -->
            <div class="bg-gray-800 border border-gray-700 rounded-xl p-6">
              <h3 class="text-lg font-bold text-white mb-4">Need Help?</h3>
              <div class="space-y-3">
                <a href="tel:01458860339" class="flex items-center space-x-3 text-gray-300 hover:text-red-400 transition-colors">
                  <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                  </svg>
                  <span>01458 860339</span>
                </a>
                <a href="https://wa.me/447415526331" target="_blank" class="flex items-center space-x-3 text-gray-300 hover:text-red-400 transition-colors">
                  <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.104"/>
                  </svg>
                  <span>WhatsApp Us</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FAQs Section -->
  <FAQs
    title="Booking FAQs"
    subtitle="Common questions about our online booking system"
    columns={2}
    items={[
      { 
        title: 'How accurate are the online prices?', 
        description: 'Our online prices are based on typical properties and are 95% accurate. Final pricing is confirmed after we see your property details.' 
      },
      { 
        title: 'Can I change my booking after submitting?', 
        description: 'Yes! Contact us within 24 hours to modify services, dates, or frequencies. We\'re flexible and want to meet your needs.' 
      },
      { 
        title: 'How does payment work?', 
        description: 'We collect payment after each clean via Direct Debit (preferred), card, or bank transfer. No upfront payments required.' 
      },
      { 
        title: 'What if I\'m not satisfied?', 
        description: 'We offer a 48-hour spot-free guarantee. Report any issues and we\'ll return to fix them free of charge.' 
      },
      { 
        title: 'Do you provide equipment and materials?', 
        description: 'Yes, we bring all professional equipment, pure water systems, and cleaning materials. You don\'t need to provide anything.' 
      },
      { 
        title: 'What if it rains?', 
        description: 'We clean in light rain as pure water dries streak-free. In heavy rain, we\'ll reschedule your appointment automatically.' 
      },
    ]}
  />

  <!-- Call to Action -->
  <CallToAction
    title="Prefer to speak to someone?"
    subtitle="Our friendly team is available Monday-Friday 8am-6pm to help with quotes and bookings."
    actions={[
      { variant: 'primary', text: 'Call 01458 860339', href: 'tel:01458860339', icon: 'tabler:phone' },
      { text: 'WhatsApp Quote', href: 'https://wa.me/447415526331?text=Hi%20Somerset%20Window%20Cleaning%2C%20I%27d%20like%20to%20book%20window%20cleaning', icon: 'tabler:brand-whatsapp' },
    ]}
  />
</Layout>

<script>
import { calculateGutterClearingPrice, calculateAddonPrice } from '../utils/bookingPricing.ts';

// Global form state
let formData = {
  selectedWindowService: null,
  propertyType: '',
  bedrooms: '',
  initialWindowPrice: 0,
  selectedFrequency: '',
  frequencyId: '',
  isCustomQuote: false,
  isCommercial: false,
  isResidential: false,
  isGeneralEnquiry: false,
  additionalServices: {
    conservatoryRoof: false,
    fasciaSoffitGutter: false,
    gutterClearing: false
  },
  quoteRequests: [],
  generalEnquiry: {
    services: [],
    frequency: '',
    additionalInfo: ''
  },
  customResidential: {
    propertyStyle: '',
    services: [],
    frequency: '',
    additionalInfo: ''
  },
  commercial: {
    propertyType: '',
    size: '',
    services: [],
    frequency: '',
    additionalInfo: ''
  },
  propertyDetails: {
    firstName: '',
    lastName: '',
    email: '',
    phone: '',
    address: '',
    postcode: '',
    accessInfo: '',
    additionalInfo: ''
  },
  totalPrice: 0,
  grandTotal: 0,
  subTotalBeforeDiscount: 0,
  windowCleaningDiscount: 0
};

let currentStep = 1;
let selectedPropertyCard = null;
let selectedFrequencyCard = null;

// EmailJS Configuration
const EMAILJS_SERVICE_ID = 'service_cwqvutf';
const EMAILJS_TEMPLATE_ID = 'template_booking_form';
const EMAILJS_USER_ID = 'ljhOh4QVqK9iQDVWO';

// reCAPTCHA Configuration
const RECAPTCHA_SITE_KEY = '6LcuV6ArAAAAAOSDE-o2Evkq704THds9m9KQpQge';
let recaptchaWidgetId = null;

// Load EmailJS
(function() {
  const script = document.createElement('script');
  script.src = 'https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js';
  script.onload = function() {
    window.emailjs.init(EMAILJS_USER_ID);
  };
  document.head.appendChild(script);
})();

// Load reCAPTCHA
function initRecaptcha() {
  const container = document.getElementById('recaptcha');
  if (container && window.grecaptcha && recaptchaWidgetId === null) {
    try {
      recaptchaWidgetId = window.grecaptcha.render('recaptcha', {
        sitekey: RECAPTCHA_SITE_KEY,
        theme: 'light',
      });
    } catch (e) {
      console.log('reCAPTCHA error:', e);
    }
  }
}

if (!window.grecaptcha) {
  const script = document.createElement('script');
  script.src = 'https://www.google.com/recaptcha/api.js?onload=initRecaptcha&render=explicit';
  script.async = true;
  script.defer = true;
  document.head.appendChild(script);
  window.initRecaptcha = initRecaptcha;
} else {
  initRecaptcha();
}

// Fixed frequency adjustment functions
const frequencyAdjustments = {
  '4-weekly': (price) => price, // Base price - no adjustment
  '8-weekly': (price) => price + 3, // +£3
  '12-weekly': (price) => price + 5, // +£5
  'adhoc': (price) => price + 20 // +£20 for one-off
};

// Property card selection
document.querySelectorAll('.property-card').forEach(card => {
  card.addEventListener('click', () => {
    // Clear previous selections
    document.querySelectorAll('.property-card').forEach(c => {
      c.classList.remove('border-red-500', 'bg-gray-600');
      c.classList.add('border-gray-600');
    });
    
    // Select current card
    card.classList.add('border-red-500', 'bg-gray-600');
    card.classList.remove('border-gray-600');
    selectedPropertyCard = card;
    
    const serviceId = card.dataset.serviceId;
    const type = card.dataset.type;
    const bedrooms = card.dataset.bedrooms;
    const basePrice = parseInt(card.dataset.basePrice) || 0;
    const isCustom = card.dataset.isCustom === 'true';
    const isCommercial = card.dataset.isCommercial === 'true';
    const isGeneral = card.dataset.isGeneral === 'true';
    
    // Update form data
    formData.propertyType = type;
    formData.bedrooms = bedrooms;
    formData.isCustomQuote = isCustom;
    formData.isCommercial = isCommercial;
    formData.isGeneralEnquiry = isGeneral;
    formData.isResidential = !isCustom && !isCommercial && !isGeneral;
    
    // Show/hide frequency selection based on property type
    const frequencySection = document.getElementById('frequency-selection');
    if (isCustom || isCommercial || isGeneral) {
      frequencySection.classList.add('hidden');
      // For custom quotes, skip to appropriate step
      if (isGeneral) {
        formData.selectedFrequency = '';
        formData.frequencyId = '';
        showStep(2); // Go to additional services for general enquiry
      } else {
        formData.selectedFrequency = isCommercial ? 'Business Enquiry' : 'Custom Quote';
        formData.frequencyId = isCommercial ? 'business_enquiry' : 'custom_quote';
        showStep(3); // Go to property details for quotes
      }
    } else {
      frequencySection.classList.remove('hidden');
      formData.selectedWindowService = {
        id: serviceId,
        type: type,
        bedrooms: bedrooms,
        basePrice: basePrice
      };
    }
    
    updatePriceSummary();
  });
});

// Frequency selection
document.querySelectorAll('.frequency-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    // Clear previous selections
    document.querySelectorAll('.frequency-btn').forEach(b => {
      b.classList.remove('border-red-500', 'bg-gray-600');
      b.classList.add('border-gray-600');
    });
    
    // Select current button
    btn.classList.add('border-red-500', 'bg-gray-600');
    btn.classList.remove('border-gray-600');
    selectedFrequencyCard = btn;
    
    const frequencyId = btn.dataset.frequencyId;
    const adjustment = parseInt(btn.dataset.adjustment) || 0;
    
    // Update form data
    formData.frequencyId = frequencyId;
    formData.selectedFrequency = btn.querySelector('div').textContent;
    
    if (formData.selectedWindowService) {
      const adjustedPrice = formData.selectedWindowService.basePrice + adjustment;
      formData.initialWindowPrice = adjustedPrice;
      formData.grandTotal = adjustedPrice;
      formData.subTotalBeforeDiscount = adjustedPrice;
      formData.selectedWindowService.calculatedPrice = adjustedPrice;
    }
    
    // Enable continue button
    document.getElementById('continue-to-step-2').disabled = false;
    
    updatePriceSummary();
  });
});

// Fixed step navigation
document.addEventListener('DOMContentLoaded', function() {
  const continueBtn = document.getElementById('continue-to-step-2');
  if (continueBtn) {
    continueBtn.addEventListener('click', (e) => {
      e.preventDefault();
      console.log('Continue button clicked');
      showStep(2);
    });
  }
});

function showStep(step) {
  console.log('Showing step:', step);
  
  // Hide all steps
  for (let i = 1; i <= 4; i++) {
    const stepElement = document.getElementById(`step-${i}`);
    if (stepElement) {
      stepElement.classList.add('hidden');
    }
  }
  
  // Show target step
  const targetStep = document.getElementById(`step-${step}`);
  if (targetStep) {
    targetStep.classList.remove('hidden');
  }
  
  // Update progress indicators
  updateProgressIndicators(step);
  
  currentStep = step;
  
  // Populate step content
  if (step === 2) {
    populateAdditionalServices();
  } else if (step === 3) {
    populatePropertyDetails();
  } else if (step === 4) {
    populateReviewAndSubmit();
  }
}

function updateProgressIndicators(activeStep) {
  for (let i = 1; i <= 4; i++) {
    const indicator = document.getElementById(`step-${i}-indicator`);
    const progress = document.getElementById(`progress-${i}`);
    
    if (i < activeStep) {
      // Completed step
      indicator.className = 'w-8 h-8 bg-green-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300';
      indicator.innerHTML = '✓';
      if (progress) progress.style.width = '100%';
    } else if (i === activeStep) {
      // Active step
      indicator.className = 'w-8 h-8 bg-red-600 text-white rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300';
      indicator.textContent = i;
      if (progress) progress.style.width = '50%';
    } else {
      // Future step
      indicator.className = 'w-8 h-8 bg-gray-600 text-gray-300 rounded-full flex items-center justify-center text-sm font-bold transition-all duration-300';
      indicator.textContent = i;
      if (progress) progress.style.width = '0%';
    }
    
    // Update step labels
    const label = indicator.nextElementSibling;
    if (label) {
      if (i <= activeStep) {
        label.classList.remove('text-gray-300');
        label.classList.add('text-white');
      } else {
        label.classList.add('text-gray-300');
        label.classList.remove('text-white');
      }
    }
  }
}

function populateAdditionalServices() {
  const content = document.getElementById('additional-services-content');
  
  if (formData.isGeneralEnquiry) {
    // General enquiry form
    content.innerHTML = `
      <p class="text-gray-300 mb-6">Tell us about the services you're interested in:</p>
      
      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-white mb-3">Services Required (select all that apply)</label>
          <div class="grid md:grid-cols-2 gap-4">
            <label class="flex items-center p-4 border-2 border-gray-600 rounded-lg hover:border-red-500 cursor-pointer transition-all bg-gray-700">
              <input type="checkbox" name="general-services" value="windowCleaning" class="w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500 mr-3">
              <div>
                <div class="font-medium text-white">Window Cleaning</div>
                <div class="text-sm text-gray-300">Inside & outside cleaning</div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-600 rounded-lg hover:border-red-500 cursor-pointer transition-all bg-gray-700">
              <input type="checkbox" name="general-services" value="conservatoryWindows" class="w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500 mr-3">
              <div>
                <div class="font-medium text-white">Conservatory Windows</div>
                <div class="text-sm text-gray-300">Panels and frames</div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-600 rounded-lg hover:border-red-500 cursor-pointer transition-all bg-gray-700">
              <input type="checkbox" name="general-services" value="gutterClearing" class="w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500 mr-3">
              <div>
                <div class="font-medium text-white">Gutter Clearing</div>
                <div class="text-sm text-gray-300">High-reach vacuum system</div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-600 rounded-lg hover:border-red-500 cursor-pointer transition-all bg-gray-700">
              <input type="checkbox" name="general-services" value="fasciaSoffitGutter" class="w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500 mr-3">
              <div>
                <div class="font-medium text-white">Fascia & Soffit</div>
                <div class="text-sm text-gray-300">UPVC cleaning</div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-600 rounded-lg hover:border-red-500 cursor-pointer transition-all bg-gray-700">
              <input type="checkbox" name="general-services" value="conservatoryRoof" class="w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500 mr-3">
              <div>
                <div class="font-medium text-white">Conservatory Roof</div>
                <div class="text-sm text-gray-300">Complete cleaning</div>
              </div>
            </label>
            <label class="flex items-center p-4 border-2 border-gray-600 rounded-lg hover:border-red-500 cursor-pointer transition-all bg-gray-700">
              <input type="checkbox" name="general-services" value="solarPanels" class="w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500 mr-3">
              <div>
                <div class="font-medium text-white">Solar Panel Cleaning</div>
                <div class="text-sm text-gray-300">Maintain efficiency</div>
              </div>
            </label>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-white mb-3">Preferred Frequency</label>
          <select id="general-frequency" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white">
            <option value="">Select frequency</option>
            <option value="oneOff">One-off clean</option>
            <option value="4weekly">Every 4 weeks</option>
            <option value="8weekly">Every 8 weeks</option>
            <option value="12weekly">Every 12 weeks</option>
            <option value="asRequired">As required</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium text-white mb-3">Additional Information</label>
          <textarea id="general-additional-info" rows="3" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white" 
                    placeholder="Any specific requirements or questions?"></textarea>
        </div>
      </div>

      <div class="flex space-x-4 mt-8">
        <button type="button" onclick="showStep(1)" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-medium py-3 px-4 rounded-lg transition-all">
          Back to Property Type
        </button>
        <button type="button" onclick="continueFromGeneralEnquiry()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg transition-all">
          Continue to Details
        </button>
      </div>
    `;
  } else if (formData.isResidential) {
    // Standard residential additional services
    content.innerHTML = `
      <p class="text-gray-300 mb-6">Add extra services to your window cleaning:</p>
      
      <div class="grid md:grid-cols-2 gap-6">
        <div class="addon-service-card border-2 border-gray-600 rounded-lg p-6 hover:border-red-500 transition-all bg-gray-700">
          <label class="flex items-start cursor-pointer">
            <input type="checkbox" name="addon-services" value="gutterClearing" class="addon-checkbox mt-1 w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500">
            <div class="ml-3 flex-1">
              <div class="font-medium text-white">Gutter Clearing</div>
              <div class="text-sm text-gray-300 mt-1">High-reach vacuum system with photo report</div>
              <div class="text-sm font-semibold text-red-400 mt-2" id="gutter-price">+£${calculateGutterClearingPrice(formData.propertyType, formData.bedrooms)}</div>
            </div>
          </label>
        </div>

        <div class="addon-service-card border-2 border-gray-600 rounded-lg p-6 hover:border-red-500 transition-all bg-gray-700">
          <label class="flex items-start cursor-pointer">
            <input type="checkbox" name="addon-services" value="fasciaSoffitGutter" class="addon-checkbox mt-1 w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500">
            <div class="ml-3 flex-1">
              <div class="font-medium text-white">Fascia & Soffit Cleaning</div>
              <div class="text-sm text-gray-300 mt-1">UPVC cleaning, removes algae and grime</div>
              <div class="text-sm font-semibold text-red-400 mt-2" id="fascia-price">+£${calculateAddonPrice('fasciaSoffitGutter', formData.propertyType, formData.bedrooms)}</div>
            </div>
          </label>
        </div>

        <div class="addon-service-card border-2 border-gray-600 rounded-lg p-6 hover:border-red-500 transition-all bg-gray-700">
          <label class="flex items-start cursor-pointer">
            <input type="checkbox" name="addon-services" value="conservatoryRoof" class="addon-checkbox mt-1 w-5 h-5 text-red-600 border-gray-500 rounded focus:ring-red-500">
            <div class="ml-3 flex-1">
              <div class="font-medium text-white">Conservatory Roof Cleaning</div>
              <div class="text-sm text-gray-300 mt-1">Panels and frames, algae removal</div>
              <div class="text-sm font-semibold text-red-400 mt-2">Quote Required</div>
            </div>
          </label>
        </div>
      </div>

      <div class="flex space-x-4 mt-8">
        <button type="button" onclick="showStep(1)" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-medium py-3 px-4 rounded-lg transition-all">
          Back to Property Type
        </button>
        <button type="button" onclick="continueFromAdditionalServices()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg transition-all">
          Continue to Details
        </button>
      </div>
    `;

    // Add addon service selection handlers
    document.querySelectorAll('.addon-checkbox').forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const serviceCard = checkbox.closest('.addon-service-card');
        const serviceName = checkbox.value;
        
        if (checkbox.checked) {
          serviceCard.classList.add('border-red-500');
          serviceCard.classList.remove('border-gray-600');
          formData.additionalServices[serviceName] = true;
          
          if (serviceName === 'conservatoryRoof') {
            formData.quoteRequests.push('conservatoryRoofCleaning');
          }
        } else {
          serviceCard.classList.remove('border-red-500');
          serviceCard.classList.add('border-gray-600');
          formData.additionalServices[serviceName] = false;
          
          if (serviceName === 'conservatoryRoof') {
            formData.quoteRequests = formData.quoteRequests.filter(req => req !== 'conservatoryRoofCleaning');
          }
        }
        
        updatePriceSummary();
      });
    });
  }
}

function continueFromGeneralEnquiry() {
  // Collect general enquiry data
  const selectedServices = Array.from(document.querySelectorAll('input[name="general-services"]:checked')).map(cb => cb.value);
  const frequency = document.getElementById('general-frequency').value;
  const additionalInfo = document.getElementById('general-additional-info').value;
  
  if (selectedServices.length === 0) {
    alert('Please select at least one service');
    return;
  }
  
  formData.generalEnquiry = {
    services: selectedServices,
    frequency: frequency,
    additionalInfo: additionalInfo
  };
  
  showStep(3);
}

function continueFromAdditionalServices() {
  // Calculate total with addons
  let total = formData.initialWindowPrice || 0;
  
  Object.keys(formData.additionalServices).forEach(serviceName => {
    if (formData.additionalServices[serviceName] && serviceName !== 'conservatoryRoof') {
      total += calculateAddonPrice(serviceName, formData.propertyType, formData.bedrooms);
    }
  });
  
  formData.grandTotal = total;
  formData.subTotalBeforeDiscount = total;
  
  showStep(3);
}

function populatePropertyDetails() {
  // Implementation for property details form
  const content = document.getElementById('property-details-content');
  content.innerHTML = `
    <p class="text-gray-300 mb-6">Please provide your contact and property details:</p>
    
    <div class="space-y-6">
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <label for="first-name" class="block text-sm font-medium text-white mb-2">First Name *</label>
          <input type="text" id="first-name" required class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white">
        </div>
        <div>
          <label for="last-name" class="block text-sm font-medium text-white mb-2">Last Name *</label>
          <input type="text" id="last-name" required class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white">
        </div>
      </div>
      
      <div>
        <label for="email" class="block text-sm font-medium text-white mb-2">Email Address *</label>
        <input type="email" id="email" required class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white">
      </div>
      
      <div>
        <label for="phone" class="block text-sm font-medium text-white mb-2">Phone Number *</label>
        <input type="tel" id="phone" required class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white">
      </div>
      
      <div>
        <label for="address" class="block text-sm font-medium text-white mb-2">Property Address *</label>
        <textarea id="address" rows="3" required class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white" placeholder="Include house number, street name, town, and postcode"></textarea>
      </div>
      
      <div>
        <label for="postcode" class="block text-sm font-medium text-white mb-2">Postcode *</label>
        <input type="text" id="postcode" required class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white" placeholder="e.g. BA16 0HW">
      </div>
      
      <div>
        <label for="access-info" class="block text-sm font-medium text-white mb-2">Access Information</label>
        <textarea id="access-info" rows="2" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white" 
                  placeholder="Locked gates, dogs, preferred times, etc."></textarea>
      </div>

      <div>
        <label for="additional-info" class="block text-sm font-medium text-white mb-2">Additional Information</label>
        <textarea id="additional-info" rows="2" class="w-full px-4 py-3 border border-gray-600 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent bg-gray-700 text-white" 
                  placeholder="Any other requirements or questions?"></textarea>
      </div>
    </div>

    <div class="flex space-x-4 mt-8">
      <button type="button" onclick="showStep(2)" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-medium py-3 px-4 rounded-lg transition-all">
        Back to Services
      </button>
      <button type="button" onclick="continueFromPropertyDetails()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-medium py-3 px-4 rounded-lg transition-all">
        Continue to Review
      </button>
    </div>
  `;
}

function continueFromPropertyDetails() {
  if (!validateContactDetails()) return;
  
  // Collect property details
  formData.propertyDetails = {
    firstName: document.getElementById('first-name').value,
    lastName: document.getElementById('last-name').value,
    email: document.getElementById('email').value,
    phone: document.getElementById('phone').value,
    address: document.getElementById('address').value,
    postcode: document.getElementById('postcode').value,
    accessInfo: document.getElementById('access-info')?.value || '',
    additionalInfo: document.getElementById('additional-info')?.value || ''
  };
  
  showStep(4);
}

function validateContactDetails() {
  const requiredFields = ['first-name', 'last-name', 'email', 'phone', 'address', 'postcode'];
  for (const fieldId of requiredFields) {
    const field = document.getElementById(fieldId);
    if (!field?.value.trim()) {
      alert(`Please fill in the ${field?.previousElementSibling?.textContent?.replace(' *', '') || fieldId}`);
      field?.focus();
      return false;
    }
  }
  
  // Basic email validation
  const email = document.getElementById('email').value;
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!emailRegex.test(email)) {
    alert('Please enter a valid email address');
    document.getElementById('email').focus();
    return false;
  }
  
  return true;
}

function populateReviewAndSubmit() {
  // Implementation for review and submit
  const content = document.getElementById('review-content');
  content.innerHTML = `
    <div class="space-y-6">
      <div class="bg-gray-700 rounded-lg p-6">
        <h3 class="font-semibold text-white mb-4">Review Your Booking</h3>
        <p class="text-gray-300">Please review your details and click submit to complete your booking.</p>
      </div>

      <!-- reCAPTCHA -->
      <div id="recaptcha"></div>

      <div class="flex space-x-4">
        <button type="button" onclick="showStep(3)" class="flex-1 bg-gray-600 hover:bg-gray-500 text-white font-medium py-3 px-4 rounded-lg transition-all">
          Back to Details
        </button>
        <button type="button" onclick="submitBooking()" class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-4 rounded-lg transition-all" id="submit-btn">
          Submit Booking
        </button>
      </div>
    </div>
  `;
  
  // Initialize reCAPTCHA
  setTimeout(initRecaptcha, 100);
}

async function submitBooking() {
  // Basic submit functionality
  alert('Booking submitted successfully! We will contact you within 24 hours.');
}

function updatePriceSummary() {
  const summary = document.getElementById('price-summary');
  
  if (formData.isResidential && formData.selectedWindowService && formData.frequencyId) {
    let total = formData.initialWindowPrice || 0;
    let breakdown = [`Window Cleaning: £${formData.initialWindowPrice}`];
    
    // Add addon services
    Object.keys(formData.additionalServices).forEach(serviceName => {
      if (formData.additionalServices[serviceName] && serviceName !== 'conservatoryRoof') {
        const price = calculateAddonPrice(serviceName, formData.propertyType, formData.bedrooms);
        total += price;
        const displayName = serviceName.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
        breakdown.push(`${displayName}: £${price}`);
      }
    });
    
    if (formData.additionalServices.conservatoryRoof) {
      breakdown.push('Conservatory Roof: Quote Required');
    }
    
    summary.innerHTML = `
      <div class="space-y-3">
        <div class="text-center">
          <div class="text-3xl font-bold text-red-400">£${total}</div>
          <div class="text-sm text-gray-300">${formData.selectedFrequency}</div>
        </div>
        <div class="border-t border-gray-600 pt-3 space-y-2 text-sm">
          ${breakdown.map(item => `<div class="text-gray-300">${item}</div>`).join('')}
        </div>
      </div>
    `;
  } else if (formData.propertyType) {
    summary.innerHTML = `
      <div class="text-center text-gray-300">
        <div class="text-2xl font-bold text-red-400">${formData.isCommercial ? 'Business Enquiry' : formData.isCustomQuote ? 'Custom Quote' : formData.isGeneralEnquiry ? 'Quote Required' : 'Quote'}</div>
        <div class="text-sm mt-2">We'll provide detailed pricing based on your requirements</div>
      </div>
    `;
  } else {
    summary.innerHTML = `
      <div class="text-center text-gray-400">
        <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 24 24">
            <path d="M7 4V2C7 1.45 7.45 1 8 1H16C16.55 1 17 1.45 17 2V4H20C20.55 4 21 4.45 21 5S20.55 6 20 6H19V19C19 20.1 18.1 21 17 21H7C5.9 21 5 20.1 5 19V6H4C3.45 6 3 5.55 3 5S3.45 4 4 4H7ZM9 3V4H15V3H9ZM7 6V19H17V6H7Z"/>
          </svg>
        </div>
        <p class="text-white">Select your property type to see pricing</p>
      </div>
    `;
  }
}

// Initialize pricing on load
updatePriceSummary();
</script>